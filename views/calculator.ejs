<br><br>
<div class="container py-4">
  <h2 class="mb-4 text-center">EMI Calculator</h2>

  <div class="row g-4">
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm p-3">
        <h5 class="mb-3">Adjust Values</h5>

        <label class="form-label">Loan Amount: <span id="loanAmountVal">500000</span></label>
        <input type="range" class="form-range" min="0" max="2000000" step="10000" value="500000" id="loanAmount">

        <label class="form-label mt-3">Tenure (Months): <span id="tenureVal">60</span></label>
        <input type="range" class="form-range" min="0" max="240" step="12" value="60" id="tenure">

        <label class="form-label mt-3">Interest Rate (%): <span id="rateVal">8</span></label>
        <input type="range" class="form-range" min="0" max="20" step="0.1" value="8" id="interestRate">
      </div>
      <a href="/calculator" class="btn btn-primary mt-2">Reset</a>
    </div>

    <div class="col-12 col-lg-8">
      <div class="card shadow-sm p-3">
        <h5 class="mb-3">Results</h5>
        <p class="mb-1">Monthly EMI: <strong><span id="emi">0</span></strong></p>
        <p class="mb-1">Total Interest: <strong><span id="totalInterest">0</span></strong></p>
        <p>Total Payment: <strong><span id="totalPayment">0</span></strong></p>
        <div style="height:300px;">
          <canvas id="emiChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('emiChart').getContext('2d');

  function formatCurrency(num) {
    if (isNaN(num) || !isFinite(num)) return "â‚¹0";
    return num.toLocaleString('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });
  }

  let loanAmount = 500000;
  let tenure = 60;
  let rate = 8;

  function calculateEMI(p, n, r) {
    if (n === 0 || r === 0) return 0;
    const monthlyRate = r / 12 / 100;
    const emi = (p * monthlyRate * Math.pow(1 + monthlyRate, n)) / 
                (Math.pow(1 + monthlyRate, n) - 1);
    return emi;
  }

  const emiChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Principal', 'Interest'],
      datasets: [{
        data: [loanAmount, 0],
        backgroundColor: ['#0d6efd', '#ffc107'],
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  function updateCalculator() {
    loanAmount = +document.getElementById('loanAmount').value;
    tenure = +document.getElementById('tenure').value;
    rate = +document.getElementById('interestRate').value;

    document.getElementById('loanAmountVal').textContent = formatCurrency(loanAmount);
    document.getElementById('tenureVal').textContent = tenure;
    document.getElementById('rateVal').textContent = rate;

    const emi = calculateEMI(loanAmount, tenure, rate);
    const totalPayment = isNaN(emi) ? 0 : Math.round(emi * tenure);
    const totalInterest = totalPayment > 0 ? totalPayment - loanAmount : 0;

    document.getElementById('emi').textContent = formatCurrency(Math.round(emi));
    document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
    document.getElementById('totalPayment').textContent = formatCurrency(totalPayment);

    emiChart.data.datasets[0].data = [loanAmount, totalInterest];
    emiChart.update();
  }

  document.getElementById('loanAmount').addEventListener('input', updateCalculator);
  document.getElementById('tenure').addEventListener('input', updateCalculator);
  document.getElementById('interestRate').addEventListener('input', updateCalculator);

  updateCalculator();
</script>
